<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../payload-dragon/payload-dragon.html">
<link rel="import" href="../payload-fairing/payload-fairing.html">

<dom-module id="launch-vehicle">
  <template>
    <style>
      :host {
        display: inline-block;
      }

      #payloadImage {
        margin-bottom: -7px;
        z-index: 2;
      }

      #boosterImage {
        z-index: 1;
      }

      .rocket-area {
        align-items: center;
        display: flex;
        flex-direction: column;

        --paper-tooltip-background: #fff;
        --paper-tooltip-text-color: #333;
        --paper-tooltip: {
          padding: 16px;
          border-radius: 8px;
          border: 0.5px solid #ddd;
          font-size: 1em;
        }
      }

      paper-tooltip h2 {
        margin: 0;
        padding-bottom: 8px;
        border-bottom: 0.5px solid #ddd;
        font-weight: 600;
      }
    </style>
    <h3>Rocket Info</h3>
    <p id="rocketId">Rocket ID: <code>[[vehicleData.rocket_id]]</code></p>
    <div class="rocket-area">
      <img src="./images/falcon-svg/payload/[[payloadImagePath(isDragon)]].svg" id="payloadImage">
      <img src="./images/falcon-svg/[[buildBoosterImage(vehicleData,landingAttempt)]].svg" id="boosterImage">
      <paper-tooltip for="boosterImage" position="right">
        <h2>Core [[coreSerial]] - [[vehicleData.rocket_name]] [[vehicleData.rocket_type]]</h2>
        <ul>
          <li>Reusable: [[isReusable(landingAttempt)]]</li>
        </ul>
      </paper-tooltip>
    <div>

  </template>

  <script>
    /**
     * @customElement launch-vehicle
     * @polymer
     */
     class LaunchVehicle extends Polymer.Element {
       static get is() { return 'launch-vehicle'; }
       static get properties() {
         return {
           vehicleData: {
             type: Object,
             reflectToAttribute: true,
             value: { rocket_id: 'unknown', rocket_name: 'Unknown Rocket', rocket_type: 'Unknown Type'}
           },
           payloadType: {
             type: String,
             reflectToAttribute: true
           },
           landingAttempt: {
             type: Boolean,
             reflectToAttribute: true
           },
           isDragon: {
             type: Boolean,
             computed: '_isPayloadDragon(payloadType)'
           },
           coreSerial: {
             type: String,
             reflectToAttribute: true
           }
         };
       }

       vehicleDataString(data) {
         return JSON.stringify(data);
       }

       buildBoosterImage(vehicleData, landingAttempt){
         let imagePath = vehicleData.rocket_id;
         let isReuse = landingAttempt ? "reuse" : "expendable";

         if (vehicleData.rocket_id == "falcon9") {
           if (vehicleData.rocket_type == "v1.0") {
             imagePath += "-" + vehicleData.rocket_type;
           } else if (vehicleData.rocket_type == "v1.1") {
             imagePath += "-" + vehicleData.rocket_type + "-" + isReuse;
           } else if (vehicleData.rocket_type == "v1.2" || vehicleData.rocket_type == "FT") {
             imagePath += "-v1.2-" + isReuse;
           }
         }
         return imagePath;
       }

       payloadImagePath(dragon) {
         if (this.vehicleData.rocket_id != "falcon1") return dragon ? "dragon" : "fairing";
       }

       _isPayloadDragon(_payloadType) {
         return _payloadType.toLowerCase().includes('dragon');
       }

       _satellite() {
         return !this.isDragon && (this.vehicleData.rocket_id != 'falcon1');
       }

       isReusable(landingAttempt) {
         return landingAttempt ? "Yes" : "No";
       }
     }

     window.customElements.define(LaunchVehicle.is, LaunchVehicle);
  </script>
</dom-module>
