<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../payload-dragon/payload-dragon.html">
<link rel="import" href="../payload-fairing/payload-fairing.html">

<dom-module id="launch-vehicle">
  <template>
    <style>
      :host {
        display: inline-block;
      }
      .rocket-area {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
    </style>
    <h3>Rocket Info</h3>
    <p id="rocketId">Rocket ID: <code>[[vehicleData.rocket_id]]</code></p>
    <p id="rocketName">Rocket Name: [[vehicleData.rocket_name]]</p>
    <p id="rocketType">Rocket Type: [[vehicleData.rocket_type]]</p>
    <div class="rocket-area">
      <template is="dom-if" if="[[isDragon]]">
        <payload-dragon></payload-dragon>
      </template>
      <template is="dom-if" if="[[_satellite()]]">
        <payload-fairing></payload-fairing>
      </template>
      <img src="./images/falcon-svg/[[buildBoosterImage(vehicleData,landingAttempt)]].svg">
    <div>

  </template>

  <script>
    /**
     * @customElement launch-vehicle
     * @polymer
     */
     class LaunchVehicle extends Polymer.Element {
       static get is() { return 'launch-vehicle'; }
       static get properties() {
         return {
           vehicleData: {
             type: Object,
             reflectToAttribute: true,
             value: { rocket_id: 'unknown', rocket_name: 'Unknown Rocket', rocket_type: 'Unknown Type'}
           },
           payloadType: {
             type: String,
             reflectToAttribute: true
           },
           landingAttempt: {
             type: Boolean,
             reflectToAttribute: true
           },
           isDragon: {
             type: Boolean,
             computed: '_isPayloadDragon(payloadType)'
           }
         };
       }

       vehicleDataString(data) {
         return JSON.stringify(data);
       }

       buildBoosterImage(vehicleData, landingAttempt){
         let imagePath = vehicleData.rocket_id;
         let isReuse = landingAttempt ? "reuse" : "expendable";

         if (vehicleData.rocket_id == "falcon9") {
           if (vehicleData.rocket_type == "v1.0") {
             imagePath += "-" + vehicleData.rocket_type;
           } else if (vehicleData.rocket_type == "v1.1") {
             imagePath += "-" + vehicleData.rocket_type + "-" + isReuse;
           } else if (vehicleData.rocket_type == "v1.2" || vehicleData.rocket_type == "FT") {
             imagePath += "-v1.2-" + isReuse;
           }
         }
         return imagePath;
       }

       _isPayloadDragon(_payloadType) {
         return _payloadType.toLowerCase().includes('dragon');
       }

       _satellite() {
         return !this.isDragon && (this.vehicleData.rocket_id != 'falcon1');
       }
     }

     window.customElements.define(LaunchVehicle.is, LaunchVehicle);
  </script>
</dom-module>
