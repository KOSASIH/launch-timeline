<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../launch-vehicle-elements/payload-dragon/payload-dragon.html">
<link rel="import" href="../launch-vehicle/launch-vehicle.html">

<dom-module id="spacex-launch">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <h2>SpaceX Launch: [[launchNumber]]</h2>
    <p id="mission"></p>
    <time id="launchDatetime"></time>
    <div id="rocket">
      <h3>Rocket Info</h3>
      <span id="rocketId"></span>
      <span id="rocketName"></span>
      <span id="rocketType"></span>
    </div>
    <p id="launchSite"></p>
    <launch-vehicle></launch-vehicle>

  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
     class SpaceXLaunch extends Polymer.Element {
       static get is() { return 'spacex-launch'; }
       static get properties() {
         return {
           launchNumber: {
             type: Number,
             reflectToAttribute: true,
             value: 1
           }
         };
       }

       constructor() {
         super();
         console.log('createdCallback');
         this.fetchData(this.getAttribute('launch-number'), this.renderInfo);
       }

       fetchData(launchNum, callback) {
         console.log('fetchData');
         fetch(`https://v2-test.herokuapp.com/v2/launches?flight_number=${launchNum}`).then((res) => {
           console.log('fetch requested');
           return res.json();
         }).then((json) => {
           console.log(json);
           console.log(this);
           callback(json[0], this);
         }).catch((err) => {
           console.error(err);
         });
       }

       renderInfo(data, el) {
         console.dir(el);
         console.log(el, el.shadowRoot, el.root);
         let dom = el.shadowRoot;

         let payload = data.payloads[0];
         el.root.querySelector('#mission').textContent =
         `${payload.payload_id} (${payload.customer})`;

         let datetime = dom.querySelector('#launchDatetime');
         datetime.setAttribute('datetime', data.launch_date_local);
         datetime.textContent = new Date(data.launch_date_local);
         datetime.title = datetime.getAttribute('datetime');
       }
     }

     window.customElements.define(SpaceXLaunch.is, SpaceXLaunch);
  </script>
</dom-module>
